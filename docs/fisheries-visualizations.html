<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>A Guide to R for Fisheries Managers</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="This is a guidebook for using R for fishery management">
  <meta name="generator" content="bookdown 0.3 and GitBook 2.6.7">

  <meta property="og:title" content="A Guide to R for Fisheries Managers" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a guidebook for using R for fishery management" />
  <meta name="github-repo" content="sfg-ucsb/fishery-manageR" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="A Guide to R for Fisheries Managers" />
  
  <meta name="twitter:description" content="This is a guidebook for using R for fishery management" />
  

<meta name="author" content="Sustainable Fisheries Group">


<meta name="date" content="2017-05-08">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="installation.html">


<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Guide to R for Fisheries Analysis</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Overview</a></li>
<li class="chapter" data-level="2" data-path="installation.html"><a href="installation.html"><i class="fa fa-check"></i><b>2</b> Installation</a><ul>
<li class="chapter" data-level="2.1" data-path="installation.html"><a href="installation.html#r"><i class="fa fa-check"></i><b>2.1</b> R</a></li>
<li class="chapter" data-level="2.2" data-path="installation.html"><a href="installation.html#rstudio"><i class="fa fa-check"></i><b>2.2</b> RStudio</a></li>
<li class="chapter" data-level="2.3" data-path="installation.html"><a href="installation.html#getting-started-with-rstudio"><i class="fa fa-check"></i><b>2.3</b> Getting Started with RStudio</a><ul>
<li class="chapter" data-level="2.3.1" data-path="installation.html"><a href="installation.html#packages"><i class="fa fa-check"></i><b>2.3.1</b> Packages</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="installation.html"><a href="installation.html#helpful-resources"><i class="fa fa-check"></i><b>2.4</b> Helpful Resources</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="fisheries-visualizations.html"><a href="fisheries-visualizations.html"><i class="fa fa-check"></i><b>3</b> Fisheries Visualizations</a><ul>
<li class="chapter" data-level="3.1" data-path="fisheries-visualizations.html"><a href="fisheries-visualizations.html#load-libraries"><i class="fa fa-check"></i><b>3.1</b> Load libraries</a></li>
<li class="chapter" data-level="3.2" data-path="fisheries-visualizations.html"><a href="fisheries-visualizations.html#load-data"><i class="fa fa-check"></i><b>3.2</b> Load data</a></li>
<li class="chapter" data-level="3.3" data-path="fisheries-visualizations.html"><a href="fisheries-visualizations.html#plot-length-data"><i class="fa fa-check"></i><b>3.3</b> Plot length data</a></li>
<li class="chapter" data-level="3.4" data-path="fisheries-visualizations.html"><a href="fisheries-visualizations.html#plot-landings-data"><i class="fa fa-check"></i><b>3.4</b> Plot landings data</a></li>
<li class="chapter" data-level="3.5" data-path="fisheries-visualizations.html"><a href="fisheries-visualizations.html#plot-cpue-data"><i class="fa fa-check"></i><b>3.5</b> Plot CPUE data</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A Guide to R for Fisheries Managers</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="fisheries-visualizations" class="section level1">
<h1><span class="header-section-number">3</span> Fisheries Visualizations</h1>
<p>This short document will walk you through some basic fisheries visualizations. You will first load packages that contain useful functions. You will next load your data. Finally, you’ll plot your data in a number of different ways, and also seeing what interesting things you can say about the fishery using these data</p>
<p>This is a very quick introduction, but a great resource for learning more is a free book called <a href="http://r4ds.had.co.nz/">R for Data Science</a>. Additionally, as you can always use R’s built in help functionality by using a question mark followed by a function name. For example, typing <code>?ggplot</code> into the console will bring up a help document on ggplot.</p>
<div id="load-libraries" class="section level2">
<h2><span class="header-section-number">3.1</span> Load libraries</h2>
<p>The first step in any analysis is the load the packages you will need for your analysis. Loading packages allows you to use powerful functions not included in “base” R.</p>
<p>For this analysis, you will use the tidyverse package, which actually loads a group of useful packages including <code>tidyr</code>, <code>dplyr</code>, and <code>ggplot2</code>. <code>tidyr</code> and <code>dplyr</code> are very handy packages for manipulating data, while <code>ggplot2</code> is one of the best packages from plotting data. You will also use <code>lubridate</code>, which helps dealing with dates and times.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse) 
<span class="kw">library</span>(lubridate) </code></pre></div>
</div>
<div id="load-data" class="section level2">
<h2><span class="header-section-number">3.2</span> Load data</h2>
<p>Next, you’ll load the data you’ll be using for the analysis using the <code>read_csv</code> function. First load the landings data which includes catch, effort, and length measurements. The data are stored as a csv under a “data” folder. Store these data to a data frame called <code>landings_data</code>. Next, load the life history parameter data file. These data are also stored as a csv under a “data” folder. Store these data to a data frame called <code>life_history_parameters</code>.</p>
<p>As data are loaded in, you’ll see that R automatically determines what type of variable each column represents - integers (for numbers), characters (for words), etc.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">landings_data &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;_data/sample_landings_data.csv&quot;</span>)

life_history_parameters &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;_data/life_history_parameters.csv&quot;</span>)</code></pre></div>
<p>Let’s take a quick look at what’s in each of these data frames. We can use the <code>head</code> function to get a quick summary.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(landings_data)</code></pre></div>
<pre><code>## # A tibble: 6 × 8
##    Year    Date Trip_ID Effort_Hours  Gear       Species Length_cm
##   &lt;int&gt;   &lt;chr&gt;   &lt;int&gt;        &lt;int&gt; &lt;chr&gt;         &lt;chr&gt;     &lt;dbl&gt;
## 1  2003 4/30/03       1           10  Trap Caesio cuning        36
## 2  2003 4/30/03       1           10  Trap Caesio cuning        29
## 3  2003 4/30/03       1           10  Trap Caesio cuning        34
## 4  2003 4/30/03       1           10  Trap Caesio cuning        36
## 5  2003 4/30/03       1           10  Trap Caesio cuning        34
## 6  2003 4/30/03       1           10  Trap Caesio cuning        28
## # ... with 1 more variables: Weight_g &lt;dbl&gt;</code></pre>
<p>The <code>landings_data</code> data frame is from a fishery-dependent landing site survey. The species included in this data set is <em>Caesio cuning</em>, a yellowtail fusilier. The survey is conducted every few days at a major landing site, and thus is just a sub-sample of the total catch. However, it is conducted throughout the year and during each season, and at the largest landings site with fishers using several different gear types and fishing throughout the entire species range, so it is fairly representative of the total catch. You can see the data frame has eight columns, with each row being an individual fish catch measurement. The columns include the year and date when the measurement was collected, the fishing trip ID, how many hours were fished for each trip, what gear was used, the species, the length of the fish, and the weight of the fish. We’ll be able to use these data to create length-frequency histograms that describe the size structure of the population, as well as trends in catch and CPUE.</p>
<p>One thing we should do is format the year and date columns to ensure that R knows these represent years and dates as we humans think of them. We can use the <code>mdy</code> and <code>year</code> functions from the lubridate package to do this.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Start with the landings data frame
landings_data &lt;-<span class="st"> </span>landings_data %&gt;%<span class="st"> </span>
<span class="st">  </span>## Turn the date column into a date format that R recognizes
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Date =</span> <span class="kw">mdy</span>(Date)) %&gt;%<span class="st"> </span>
<span class="st">  </span>## Create a year column using a year format R recognizes
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Year =</span> <span class="kw">year</span>(Date))</code></pre></div>
<p>Let’s next look at the <code>life_history_parameters</code> data frame.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(life_history_parameters)</code></pre></div>
<pre><code>## # A tibble: 1 × 11
##         Species              Common L_inf     k    t0         M     Wa
##           &lt;chr&gt;               &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;
## 1 Caesio cuning Yellowtail fusilier  62.2  0.32 -0.42 0.8915981 0.0208
## # ... with 4 more variables: Wb &lt;dbl&gt;, m50 &lt;dbl&gt;, m95 &lt;dbl&gt;, maxAge &lt;int&gt;</code></pre>
<p>The <code>life_history_parameters</code> data frame includes several important life history parameters that were found doing a literature review of this species. <em>L_infinity</em>, <em>k</em>, and <em>t0</em> describe the age-to-length relationship using the von Bertalanffy growth equation. <em>M</em> represents natural mortality. <em>Wa</em> and <em>Wb</em> describe the length-to-weight relationship. <em>m50</em> and <em>m95</em> describe the lengths at which 50% and 95% of the fish are mature, respecitvely. <em>maxAge</em> is the maximum age of the fish.</p>
</div>
<div id="plot-length-data" class="section level2">
<h2><span class="header-section-number">3.3</span> Plot length data</h2>
<p>Let’s first look at the length data from the catch, which gives an indication of the size structure and health of the population. To do this in R, you start by taking the landings data and working through a series of “pipes”, which progressively analyze the data from one step to the next and are shown with the <code>%&gt;%</code> operation. Essentially, the output of one line is fed into the input of the next line. Once you’ve formatted the data, you next feed it into ggplot to plot the data. When using ggplot to build plots, you first initialize the ggplot, and then use the <code>+</code> operation to add additional features to the plot. In all of the code below, there are also some helpful comments to tell you what each line is doing. Comments start with the <code>#</code> operation, and are not evaluated by R - they are simply there to document the code. Let’s look at the length data for 2014, which is the most recent year of data available. We first filter the data to be only from 2014. We then create a histogram of the length data, which shows how many individuals of each size class were measured in the catch. On the histogram, we’ll also a vertical line to show the length at which fish mature to get a sense of how sustainable the catch is - the catch should be composed mostly of mature fish. This information comes from the life history parameter data input file.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Start with the landings data frame
landings_data %&gt;%<span class="st"> </span>
<span class="st">  </span>## Filter data to only look at length measurements from 2014
<span class="st">  </span><span class="kw">filter</span>(Year ==<span class="st"> </span><span class="dv">2014</span>) %&gt;%<span class="st"> </span>
<span class="st">  </span>## Initialize ggplot of data using the length column
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Length_cm)) +<span class="st"> </span>
<span class="st">  </span>## Tell ggplot that the plot type should be a histogram
<span class="st">  </span><span class="kw">geom_histogram</span>() +<span class="st"> </span>
<span class="st">  </span>## Change x-axis label
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Length [cm]&quot;</span>) +<span class="st"> </span>
<span class="st">  </span>## Add figure title
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Length histogram of Caesio cuning in the catch</span><span class="ch">\n</span><span class="st">Length at 95% maturity shown as a red line.&quot;</span>) +<span class="st"> </span>
<span class="st">  </span>## Add a red vertical line for m95, the length at which 95% of fish are mature. Any fish below this length may be immature. Use the life_history_parameter data frame to get this value.
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="kw">aes</span>(<span class="dt">xintercept=</span>life_history_parameters$m95),<span class="dt">color=</span><span class="st">&quot;red&quot;</span>) </code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>You might also be interested in seeing how the size composition varies by gear type. You can recreate the figure about, but separting the histograms out by gear type using ggplot’s “facet” functionality. It appears as if the size structure is about the same from each gear, although by far the most amount of fish are caught using speargun. Very few fish are caught using trolling.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Start with the landings data frame
landings_data %&gt;%<span class="st"> </span>
<span class="st">  </span>## Filter data to only look at length measurements from 2014
<span class="st">  </span><span class="kw">filter</span>(Year ==<span class="st"> </span><span class="dv">2014</span>) %&gt;%<span class="st"> </span>
<span class="st">  </span>## Initialize ggplot of data using the length column
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Length_cm)) +<span class="st"> </span>
<span class="st">  </span>## Tell ggplot that the plot type should be a histogram
<span class="st">  </span><span class="kw">geom_histogram</span>() +<span class="st"> </span>
<span class="st">  </span>## Change x-axis label
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Length [cm]&quot;</span>) +<span class="st"> </span>
<span class="st">  </span>## Add figure title
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Length histogram of Caesio cuning in the catch by gear type</span><span class="ch">\n</span><span class="st">Length at 95% maturity shown as a red line.&quot;</span>) +<span class="st"> </span>
<span class="st">  </span>## Add a red line form95, the length at which 95% of fish are mature. Any fish below this length may be immature. Use the life_history_parameter data frame to get this value.
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="kw">aes</span>(<span class="dt">xintercept=</span>life_history_parameters$m95),<span class="dt">color=</span><span class="st">&quot;red&quot;</span>) +<span class="st"> </span>
<span class="st">  </span>## This tells the figure to plot by all different gear types, known as facetting
<span class="st">  </span><span class="kw">facet_wrap</span>(~Gear) </code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>Next we can calculate the percentage of mature fish in the catch in every year of the data frame. To do this, we add a column to the data frame that represents whether each fish is mature or not (represented by a 1 or 0), group the data frame by year, and then summarize for each year the percentage of mature fish out of the total number of sampled fish. Over 90% of the fish are mature throughout the time series, which is a great sign! This matches up with what we see in the histogram.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Start with the landings data frame
landings_data %&gt;%<span class="st"> </span>
<span class="st">  </span>## Add a column to the data that indicates whether each length measurement is from a mature or immature fish. If it&#39;s mature, this value should be 1; if immature, 0.
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Mature =</span> <span class="kw">ifelse</span>(Length_cm &gt;<span class="st"> </span>life_history_parameters$m95,<span class="dv">1</span>,<span class="dv">0</span>)) %&gt;%<span class="st"> </span>
<span class="st">  </span>## Group by year so we can see the percent mature for every year
<span class="st">  </span><span class="kw">group_by</span>(Year) %&gt;%<span class="st"> </span>
<span class="st">  </span>## The percentage mature is equal to the  number of mature fish divided by the total number of fish and multiplied by 100
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">Percent_Mature =</span> <span class="kw">sum</span>(Mature) /<span class="st"> </span><span class="kw">n</span>() *<span class="st"> </span><span class="dv">100</span>) </code></pre></div>
<pre><code>## # A tibble: 9 × 2
##    Year Percent_Mature
##   &lt;dbl&gt;          &lt;dbl&gt;
## 1  2003       98.57595
## 2  2004       98.62306
## 3  2005       97.73371
## 4  2006      100.00000
## 5  2010       91.80556
## 6  2011       99.77629
## 7  2012       99.65398
## 8  2013       99.46164
## 9  2014       99.55709</code></pre>
</div>
<div id="plot-landings-data" class="section level2">
<h2><span class="header-section-number">3.4</span> Plot landings data</h2>
<p>Next, let’s plot a time series of daily landings data. We first group the data frame by date, so that we can next summarize the summed weight caught on each date. When we summarize the daily landings, we’ll also divide by 1000 to convert from g to kg. We then plot this using ggplot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Start with the landings data frame
landings_data %&gt;%<span class="st"> </span>
<span class="st">  </span>## Group the data by date so we can calculate the total landings by date
<span class="st">  </span><span class="kw">group_by</span>(Date) %&gt;%<span class="st"> </span>
<span class="st">  </span>## For each date, sumamrize the sum of all daily landings. Also convert kilograms to grams by dividing by 1000.
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">daily_landings =</span> <span class="kw">sum</span>(Weight_g/<span class="dv">1000</span>)) %&gt;%<span class="st"> </span>
<span class="st">  </span>## Initialize a ggplot of daily landings versus date
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>Date,<span class="dt">y=</span>daily_landings)) +<span class="st"> </span>
<span class="st">  </span>## Tell ggplot that the plot type should be a scatter plot
<span class="st">  </span><span class="kw">geom_point</span>() +<span class="st"> </span>
<span class="st">  </span>## Also add a line connecting the points
<span class="st">  </span><span class="kw">geom_line</span>() +<span class="st"> </span>
<span class="st">  </span>## Change the y-axis title
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Daily Landings [kg/day]&quot;</span>) +<span class="st"> </span>
<span class="st">  </span>## Add a figure title
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Daily landings of Caesio cuning&quot;</span>) </code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>It is a little diffcult to observe trends here since there is a lot of variation between days, other than that there was no data collected between 2006 and 2010. Instead, you may wish to aggregate the catch data by year in order to look at trends in annual landings. This is very similar to the plot above, but we now group and summarize by Year instead of by Date. Because this particular survey only samples the catch on certain days, it does not represent the total volume of landed catch. Therefore, it’s important to not only sum the amount of catch each year, but also normalize the sampled catch by the number of sampling days. This will mean that trends represent actual increases or decreases in catch, not just increases or decreases in how frequently the catch is sampled.</p>
<p>Looking at this plot, it now becomes more clear that landings decrease significantly between 2004 and 2010, but have been increasing during the last few years. This could be indicative of a recovering fishery, or could mean increasing fishing pressure.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Start with the landings data frame
landings_data %&gt;%<span class="st"> </span>
<span class="st">  </span>## First, group the data by year
<span class="st">  </span><span class="kw">group_by</span>(Year) %&gt;%<span class="st"> </span>
<span class="st">  </span>## Next, summarize the total annual landings per year. Also convert from grams to kilograms by dividing by 1000. Also, normalize the annual catch by the number of survey days each year.
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">Annual_Landings_kg =</span> <span class="kw">sum</span>(Weight_g,<span class="dt">na.rm=</span><span class="ot">TRUE</span>)/<span class="dv">1000</span>/<span class="kw">n_distinct</span>(Date)) %&gt;%<span class="st"> </span>
<span class="st">  </span>## Initialize a ggplot of annual landings versus year
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>Year,<span class="dt">y=</span>Annual_Landings_kg)) +
<span class="st">  </span>## Tell ggplot that the plot type should be a scatter plot
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span>## Also add a line connecting the points
<span class="st">  </span><span class="kw">geom_line</span>() +<span class="st"> </span>
<span class="st">  </span>## Change the y-axis title
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Normalized annual Landings [kg/survey day/year]&quot;</span>) +<span class="st"> </span>
<span class="st">  </span>## Add figure title
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Normalized annual landings of Caesio cuning&quot;</span>) </code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>Again, you may be interested in looking across different gear types. Here, we now group the data frame by both the year and the gear type in order to summarize the total landings by year and by gear. To plot, we again use ggplot’s faceting functionality. Doing so, it now becomes clear that the recent increase in catch seems to be concentrated in speargun and trap fishing. Meanwhile, catch from muroami, a very destructive type of gear where nets are driven into the reef, has dropped to 0 since a ban of that gear in 2012 - a good sign that mangement regulation is working.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Start with the landings data frame
landings_data %&gt;%<span class="st"> </span>
<span class="st">  </span>## First, group the data by year
<span class="st">  </span><span class="kw">group_by</span>(Year,Gear) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="co"># Next, summarize the total annual landings per year. Also convert from grams to kilograms by dividing by 1000. Also, normalize the annual catch by the number of survey days each year.</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">Annual_Landings_kg =</span> <span class="kw">sum</span>(Weight_g,<span class="dt">na.rm=</span><span class="ot">TRUE</span>)/<span class="dv">1000</span>/<span class="kw">n_distinct</span>(Date)) %&gt;%<span class="st"> </span>
<span class="st">  </span>## Initialize a ggplot of annual landings versus year
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>Year,<span class="dt">y=</span>Annual_Landings_kg)) +
<span class="st">  </span>## Tell ggplot that the plot type should be a scatter plot
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span>## Also add a line connecting the points
<span class="st">  </span><span class="kw">geom_line</span>() +<span class="st"> </span>
<span class="st">  </span>## Change the y-axis title
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Normalized annual Landings [kg/survey day/year]&quot;</span>) +<span class="st"> </span>
<span class="st">  </span>## Add figure title
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Normalized annual landings of Caesio cuning&quot;</span>) +
<span class="st">  </span>## This tells the figure to plot by all different gear types
<span class="st">  </span><span class="kw">facet_wrap</span>(~Gear) </code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
</div>
<div id="plot-cpue-data" class="section level2">
<h2><span class="header-section-number">3.5</span> Plot CPUE data</h2>
<p>Finally, you may also be interested in plotting median catch-per-unit-effort (CPUE). CPUE is calculated by dividing the catch of each fishing trip by the number of hours fished during that trip. The median is taken in order to remove outliers - some fishers are much more efficient than others.</p>
<p>CPUE appears to have increased significantly during the last years. This may be due to increasing abundance in the water, which would be a good thing, but may also be indicative of increased gear efficiency coinciding with the transition to traps and spearguns, which may be concerning.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Start with the landings data frame
landings_data %&gt;%<span class="st"> </span>
<span class="st">  </span>## Group by year and Trip ID so that you can calculate CPUE for every trip in every year
<span class="st">  </span><span class="kw">group_by</span>(Year,Trip_ID) %&gt;%<span class="st"> </span>
<span class="st">  </span>## For each year and trip ID, calculate the CPUE for each trip by dividing the sum of the catch, converted from grams to kilograms, by the trip by the number of fishing hours
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">Trip_CPUE =</span> <span class="kw">sum</span>(Weight_g/<span class="dv">1000</span>) /<span class="st"> </span><span class="kw">mean</span>(Effort_Hours)) %&gt;%<span class="st"> </span>
<span class="st">  </span>## Next, just group by year so we can calculate median CPUE for each year across all trips in the year
<span class="st">  </span><span class="kw">group_by</span>(Year) %&gt;%<span class="st"> </span>
<span class="st">  </span>## Calculate median CPUE for each year
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">Median_CPUE =</span> <span class="kw">median</span>(Trip_CPUE)) %&gt;%<span class="st"> </span>
<span class="st">  </span>## Initialize a ggplot of median CPUE versus year
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>Year,<span class="dt">y=</span>Median_CPUE)) +
<span class="st">  </span>## Tell ggplot that the plot type should be a scatter plot
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span>## Also add a line connecting the points
<span class="st">  </span><span class="kw">geom_line</span>() +<span class="st"> </span>
<span class="st">  </span>## Change the y-axis title
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Median CPUE [kg/hour]&quot;</span>) +<span class="st"> </span>
<span class="st">  </span>## Add figure title
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Median CPUE for Caesio cuning&quot;</span>) </code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>When looking at all data together - almost all fish in the catch are mature, catch is increasing, and CPUE is increasing - all signs point to a fairly healthy fishery, which is likely recovering since the ban of muroami fishing nets.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="installation.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>


<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/02-basic_fisheries_analysis.Rmd",
"text": "Edit"
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
